<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Speech Synthesis - Auto Language + Speed</title>
</head>
<body>
<h2>Speech Synthesis Demo (English + Vietnamese + Tốc độ)</h2>

<label for="speedSelect">Chọn tốc độ đọc:</label>
<select id="speedSelect">
<option value="0.7">Chậm</option>
<option value="1" selected>Bình thường</option>
<option value="1.3">Nhanh</option>
</select>

<br><br>

<button onclick="speakSmart('Hello, tôi tên là Lan. Tôi muốn hỏi bạn một tí nhé. Có phải Mr. Donald Trump là tổng thống của nước Mĩ không?')">Đọc đoạn tiếng Anh + Việt</button>
<button onclick="pauseSpeech()">Tạm dừng</button>
<button onclick="resumeSpeech()">Tiếp tục</button>

<script>
function detectLanguage(text) {
const vietnameseRegex = /[àáảãạâầấẩẫậăằắẳẵặèéẻẽẹêềếểễệìíỉĩịòóỏõọôồốổỗộơờớởỡợùúủũụưừứửữựỳýỷỹỵđ]/i;
return vietnameseRegex.test(text) ? 'vi-VN' : 'en-US';
}

function splitByLanguage(text) {
    const words = text.split(' ');
    const groups = [];
    let currentLang = detectLanguage(words[0]);
    let currentText = words[0];

    for (let i = 1; i < words.length; i++) {
        const wordLang = detectLanguage(words[i]);
        if (wordLang === currentLang) {
            currentText += ' ' + words[i];
        } else {
            groups.push({ lang: currentLang, text: currentText });
            currentLang = wordLang;
            currentText = words[i];
        }
    }
    groups.push({ lang: currentLang, text: currentText });
    return groups;
}

function speakSmart(text) {
    speechSynthesis.cancel();
    const groups = splitByLanguage(text);

    const selectedSpeed = parseFloat(document.getElementById("speedSelect").value);

    function speakNext(index) {
        if (index >= groups.length) return;

        const utterance = new SpeechSynthesisUtterance(groups[index].text);
        utterance.lang = groups[index].lang;
        utterance.rate = selectedSpeed; // Áp dụng tốc độ đã chọn

        function setVoiceAndSpeak() {
            const voices = speechSynthesis.getVoices();
            let voice = null;

            if (utterance.lang === 'vi-VN') {
                voice = voices.find(v => v.lang === 'vi-VN');
            } else {
                voice = voices.find(v => v.lang === 'en-US' && (v.name.includes('Samantha') || v.name.includes('Daniel') || v.name.includes('Karen')));
                if (!voice) voice = voices.find(v => v.lang === 'en-US');
            }

            if (voice) utterance.voice = voice;
            speechSynthesis.speak(utterance);
        }

        utterance.onend = () => speakNext(index + 1);

        if (speechSynthesis.getVoices().length > 0) {
            setVoiceAndSpeak();
        } else {
            speechSynthesis.onvoiceschanged = setVoiceAndSpeak;
        }
    }

    speakNext(0);
}

function pauseSpeech() {
    if (speechSynthesis.speaking && !speechSynthesis.paused) {
        speechSynthesis.pause();
    }
}

function resumeSpeech() {
    if (speechSynthesis.paused) {
        speechSynthesis.resume();
    }
}

</script>
</body>
</html>

